<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:KamPay.ViewModels"
             xmlns:models="clr-namespace:KamPay.Models"
             xmlns:conv="clr-namespace:KamPay.Converters"

             x:Class="KamPay.Views.AddProductPage"
             Title="Ürün Ekle"
             Shell.BackgroundColor="#4CAF50">

   

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">

            <!-- Hata Mesajı -->
            <Frame IsVisible="{Binding ErrorMessage, Converter={StaticResource StringIsNotNullOrEmptyConverter}}"
                   BackgroundColor="#FFEBEE"
                   BorderColor="#F44336"
                   Padding="10"
                   CornerRadius="8">
                <Label Text="{Binding ErrorMessage}"
                       TextColor="#C62828"
                       FontSize="14" />
            </Frame>

            <!-- Başlık -->
            <Label Text="Ürün Bilgileri" 
                   FontSize="20" 
                   FontAttributes="Bold"
                   TextColor="#333" />

            <!-- Ürün Başlığı -->
            <Frame Padding="0" 
                   BorderColor="#E0E0E0"
                   CornerRadius="8">
                <Entry Placeholder="Ürün Başlığı *"
                       Text="{Binding Title}"
                       MaxLength="100"
                       FontSize="16" />
            </Frame>

            <!-- Açıklama -->
            <Frame Padding="0" 
                   BorderColor="#E0E0E0"
                   CornerRadius="8">
                <Editor Placeholder="Ürün Açıklaması *"
                        Text="{Binding Description}"
                        HeightRequest="120"
                        MaxLength="1000"
                        FontSize="16"
                        AutoSize="TextChanges" />
            </Frame>

            <!-- Kategori Seçimi -->
            <Label Text="Kategori *" 
                   FontSize="16" 
                   FontAttributes="Bold"
                   TextColor="#666" />

            <Frame Padding="0" 
                   BorderColor="#E0E0E0"
                   CornerRadius="8">
                <Picker ItemsSource="{Binding Categories}"
                        SelectedItem="{Binding SelectedCategory}"
                        ItemDisplayBinding="{Binding Name}"
                        FontSize="16"
                        Title="Kategori Seçin" />
            </Frame>

            <Label Text="Ürün Tipi *" 
                   FontSize="16" 
                   FontAttributes="Bold"
                   TextColor="#666" />

            <Frame Padding="0" 
                   BorderColor="#E0E0E0"
                   CornerRadius="8">
                <Picker ItemsSource="{Binding ProductTypes}"
                        SelectedItem="{Binding SelectedType}"
                        FontSize="16"
                        Title="Tip Seçin">
                </Picker>
            </Frame>
            <StackLayout Orientation="Horizontal" Padding="5, 10" 
                         IsVisible="{Binding IsDonationTypeSelected}">
                <Label Text="Bu ürünü Sürpriz Kutu'ya bağışla" 
                       VerticalOptions="Center"
                       TextColor="#333"/>
                <Switch IsToggled="{Binding IsForSurpriseBox}" 
                        HorizontalOptions="EndAndExpand"
                        OnColor="#4CAF50"/>
            </StackLayout>
            <Frame IsVisible="{Binding ShowPriceField}"
                   Padding="0" 
                   BorderColor="#E0E0E0"
                   CornerRadius="8">
                <HorizontalStackLayout Padding="10">
                    <Entry Placeholder="Fiyat"
                           Text="{Binding Price}"
                           Keyboard="Numeric"
                           FontSize="16"
                           HorizontalOptions="FillAndExpand" />
                    <Label Text="₺" 
                           VerticalOptions="Center"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="#4CAF50" />
                </HorizontalStackLayout>
            </Frame>

            <!-- Takas Tercihi (Takas ise) -->
            <Frame IsVisible="{Binding ShowExchangeField}"
                   Padding="0" 
                   BorderColor="#E0E0E0"
                   CornerRadius="8">
                <Entry Placeholder="Ne ile takas yapmak istersiniz?"
                       Text="{Binding ExchangePreference}"
                       FontSize="16" />
            </Frame>

            <!-- Durum -->
            <Label Text="Ürün Durumu *" 
                   FontSize="16" 
                   FontAttributes="Bold"
                   TextColor="#666" />

            <Frame Padding="0" 
                   BorderColor="#E0E0E0"
                   CornerRadius="8">
                <Picker ItemsSource="{Binding Conditions}"
                        SelectedItem="{Binding SelectedCondition}"
                        FontSize="16"
                        Title="Durum Seçin">
                    <Picker.ItemDisplayBinding>
                        <Binding>
                            <Binding.Converter>
                                <conv:ProductConditionConverter />
                            </Binding.Converter>
                        </Binding>
                    </Picker.ItemDisplayBinding>
                </Picker>
            </Frame>

            <!-- Konum -->
            <Label Text="Konum" 
                   FontSize="16" 
                   FontAttributes="Bold"
                   TextColor="#666" />

            <HorizontalStackLayout Spacing="10">
                <Frame Padding="0" 
                       BorderColor="#E0E0E0"
                       CornerRadius="8"
                       HorizontalOptions="FillAndExpand">
                    <Entry Placeholder="Konum (ör: Kampüs, Bina A)"
                           Text="{Binding Location}"
                           FontSize="16" />
                </Frame>

                <Button Text="📍"
                        Command="{Binding UseCurrentLocationCommand}"
                        WidthRequest="50"
                        HeightRequest="50"
                        CornerRadius="25"
                        BackgroundColor="#4CAF50"
                        TextColor="White"
                        FontSize="20" />
            </HorizontalStackLayout>

            <!-- Görseller -->
            <Label Text="Ürün Görselleri (Maksimum 5)" 
                   FontSize="16" 
                   FontAttributes="Bold"
                   TextColor="#666" />

            <Button Text="📷 Görsel Ekle"
                    Command="{Binding PickImagesCommand}"
                    BackgroundColor="#2196F3"
                    TextColor="White"
                    CornerRadius="8"
                    HeightRequest="50" />

            <!-- Seçili Görseller -->
            <FlexLayout BindableLayout.ItemsSource="{Binding ImagePaths}"
                        Wrap="Wrap"
                        JustifyContent="Start"
                        AlignItems="Start">
                <BindableLayout.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="5"
                               Margin="5"
                               CornerRadius="8"
                               WidthRequest="100"
                               HeightRequest="100">
                            <Grid>
                                <Image Source="{Binding .}"
                                       Aspect="AspectFill" />
                                <Button Text="✕"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:AddProductViewModel}}, Path=RemoveImageCommand}"
                                        CommandParameter="{Binding .}"
                                        BackgroundColor="#F44336"
                                        TextColor="White"
                                        WidthRequest="30"
                                        HeightRequest="30"
                                        CornerRadius="15"
                                        HorizontalOptions="End"
                                        VerticalOptions="Start"
                                        Margin="5" />
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </BindableLayout.ItemTemplate>
            </FlexLayout>

            <!-- Butonlar -->
            <Grid ColumnDefinitions="*,*" 
                  ColumnSpacing="10"
                  Margin="0,20,0,0">
                <Button Grid.Column="0"
                        Text="İptal"
                        Command="{Binding CancelCommand}"
                        BackgroundColor="#757575"
                        TextColor="White"
                        CornerRadius="8"
                        HeightRequest="50" />

                <Button Grid.Column="1"
                        Text="Kaydet"
                        Command="{Binding SaveProductCommand}"
                        BackgroundColor="#4CAF50"
                        TextColor="White"
                        CornerRadius="8"
                        HeightRequest="50" />
            </Grid>

            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsLoading}"
                              IsVisible="{Binding IsLoading}"
                              Color="#4CAF50"
                              HeightRequest="50" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>