<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:KamPay.ViewModels"
             xmlns:models="clr-namespace:KamPay.Models"
             xmlns:conv="clr-namespace:KamPay.Converters"
             x:Class="KamPay.Views.EditProductPage"
             Title="ÃœrÃ¼nÃ¼ DÃ¼zenle"
             Shell.BackgroundColor="{StaticResource Primary}">



    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">

            <!-- Hata MesajÄ± -->
            <Frame IsVisible="{Binding ErrorMessage, Converter={StaticResource StringIsNotNullOrEmptyConverter}}"
                   BackgroundColor="#FFEBEE"
                   BorderColor="#F44336"
                   Padding="10"
                   CornerRadius="8">
                <Label Text="{Binding ErrorMessage}"
                       TextColor="#C62828"
                       FontSize="14" />
            </Frame>

            <!-- BaÅŸlÄ±k -->
            <Label Text="ÃœrÃ¼n Bilgileri" 
                   FontSize="20" 
                   FontAttributes="Bold"
                   TextColor="#333" />

            <!-- ÃœrÃ¼n BaÅŸlÄ±ÄŸÄ± -->
            <Frame Padding="0" 
                   BorderColor="#E0E0E0"
                   CornerRadius="8">
                <Entry Placeholder="ÃœrÃ¼n BaÅŸlÄ±ÄŸÄ± *"
                       Text="{Binding Title}"
                       MaxLength="100"
                       FontSize="16" />
            </Frame>

            <!-- AÃ§Ä±klama -->
            <Frame Padding="0" 
                   BorderColor="#E0E0E0"
                   CornerRadius="8">
                <Editor Placeholder="ÃœrÃ¼n AÃ§Ä±klamasÄ± *"
                        Text="{Binding Description}"
                        HeightRequest="120"
                        MaxLength="1000"
                        FontSize="16"
                        AutoSize="TextChanges" />
            </Frame>

            <!-- Kategori SeÃ§imi -->
            <Label Text="Kategori *" 
                   FontSize="16" 
                   FontAttributes="Bold"
                   TextColor="#666" />

            <Frame Padding="0" 
                   BorderColor="#E0E0E0"
                   CornerRadius="8">
                <Picker ItemsSource="{Binding Categories}"
                        SelectedItem="{Binding SelectedCategory}"
                        ItemDisplayBinding="{Binding Name}"
                        FontSize="16"
                        Title="Kategori SeÃ§in" />
            </Frame>

            <!-- ÃœrÃ¼n Tipi -->
            <Label Text="ÃœrÃ¼n Tipi *" 
                   FontSize="16" 
                   FontAttributes="Bold"
                   TextColor="#666" />

            <Frame Padding="0" 
                   BorderColor="#E0E0E0"
                   CornerRadius="8">
                <Picker ItemsSource="{Binding ProductTypes}"
                        SelectedItem="{Binding SelectedType}"
                        FontSize="16"
                        Title="Tip SeÃ§in">
                    <Picker.ItemDisplayBinding>
                        <Binding>
                            <Binding.Converter>
                                <conv:ProductTypeConverter />
                            </Binding.Converter>
                        </Binding>
                    </Picker.ItemDisplayBinding>
                </Picker>
            </Frame>

            <!-- Fiyat (SatÄ±lÄ±k ise) -->
            <Frame IsVisible="{Binding ShowPriceField}"
                   Padding="0" 
                   BorderColor="#E0E0E0"
                   CornerRadius="8">
                <HorizontalStackLayout Padding="10">
                    <Entry Placeholder="Fiyat"
                           Text="{Binding Price}"
                           Keyboard="Numeric"
                           FontSize="16"
                           HorizontalOptions="FillAndExpand" />
                    <Label Text="â‚º" 
                           VerticalOptions="Center"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="#4CAF50" />
                </HorizontalStackLayout>
            </Frame>

            <!-- Takas Tercihi (Takas ise) -->
            <Frame IsVisible="{Binding ShowExchangeField}"
                   Padding="0" 
                   BorderColor="#E0E0E0"
                   CornerRadius="8">
                <Entry Placeholder="Ne ile takas yapmak istersiniz?"
                       Text="{Binding ExchangePreference}"
                       FontSize="16" />
            </Frame>

            <!-- Durum -->
            <Label Text="ÃœrÃ¼n Durumu *" 
                   FontSize="16" 
                   FontAttributes="Bold"
                   TextColor="#666" />

            <Frame Padding="0" 
                   BorderColor="#E0E0E0"
                   CornerRadius="8">
                <Picker ItemsSource="{Binding Conditions}"
                        SelectedItem="{Binding SelectedCondition}"
                        FontSize="16"
                        Title="Durum SeÃ§in">
                    <Picker.ItemDisplayBinding>
                        <Binding>
                            <Binding.Converter>
                                <conv:ProductConditionConverter />
                            </Binding.Converter>
                        </Binding>
                    </Picker.ItemDisplayBinding>
                </Picker>
            </Frame>

            <!-- Konum -->
            <Label Text="Konum" 
                   FontSize="16" 
                   FontAttributes="Bold"
                   TextColor="#666" />

            <HorizontalStackLayout Spacing="10">
                <Frame Padding="0" 
                       BorderColor="#E0E0E0"
                       CornerRadius="8"
                       HorizontalOptions="FillAndExpand">
                    <Entry Placeholder="Konum (Ã¶r: KampÃ¼s, Bina A)"
                           Text="{Binding Location}"
                           FontSize="16" />
                </Frame>

                <Button Text="ðŸ“"
                        Command="{Binding UseCurrentLocationCommand}"
                        WidthRequest="50"
                        HeightRequest="50"
                        CornerRadius="25"
                        BackgroundColor="#4CAF50"
                        TextColor="White"
                        FontSize="20" />
            </HorizontalStackLayout>

            <!-- GÃ¶rseller -->
            <Label Text="ÃœrÃ¼n GÃ¶rselleri (Maksimum 5)" 
                   FontSize="16" 
                   FontAttributes="Bold"
                   TextColor="#666" />

            <Button Text="ðŸ“· GÃ¶rsel Ekle"
                    Command="{Binding PickImagesCommand}"
                    BackgroundColor="#2196F3"
                    TextColor="White"
                    CornerRadius="8"
                    HeightRequest="50" />

            <!-- SeÃ§ili GÃ¶rseller -->
            <FlexLayout BindableLayout.ItemsSource="{Binding ImagePaths}"
                        Wrap="Wrap"
                        JustifyContent="Start"
                        AlignItems="Start">
                <BindableLayout.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="5"
                               Margin="5"
                               CornerRadius="8"
                               WidthRequest="100"
                               HeightRequest="100">
                            <Grid>
                                <Image Source="{Binding .}"
                                       Aspect="AspectFill" />
                                <Button Text="âœ•"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:AddProductViewModel}}, Path=RemoveImageCommand}"
                                        CommandParameter="{Binding .}"
                                        BackgroundColor="#F44336"
                                        TextColor="White"
                                        WidthRequest="30"
                                        HeightRequest="30"
                                        CornerRadius="15"
                                        HorizontalOptions="End"
                                        VerticalOptions="Start"
                                        Margin="5" />
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </BindableLayout.ItemTemplate>
            </FlexLayout>

            <!-- Butonlar -->
            <Grid ColumnDefinitions="*,*" 
                  ColumnSpacing="10"
                  Margin="0,20,0,0">
                <Button Grid.Column="0"
                        Text="Ä°ptal"
                        Command="{Binding CancelCommand}"
                        BackgroundColor="#757575"
                        TextColor="White"
                        CornerRadius="8"
                        HeightRequest="50" />

                <Button Grid.Column="1"
            Text="GÃ¼ncelle" Command="{Binding SaveProductCommand}" BackgroundColor="#4CAF50"
            TextColor="White"
            CornerRadius="8"
            HeightRequest="50" />
            </Grid>

            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsLoading}"
                              IsVisible="{Binding IsLoading}"
                              Color="#4CAF50"
                              HeightRequest="50" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>